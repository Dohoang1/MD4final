<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Sửa đơn hàng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
  <h2>Sửa đơn hàng #<span th:text="${order.id}"></span></h2>

  <form th:action="@{/orders/edit}" method="post" th:object="${order}" class="mt-4">
    <input type="hidden" th:field="*{id}">

    <!-- Loại sản phẩm -->
    <div class="mb-3 row">
      <label class="col-sm-2 col-form-label">Loại sản phẩm</label>
      <div class="col-sm-4">
        <select class="form-select" id="productType" name="productTypeId">
          <option value="">Chọn loại sản phẩm</option>
          <option th:each="type : ${productTypes}"
                  th:value="${type.id}"
                  th:text="${type.name}"
                  th:selected="${order.product.productType.id == type.id}">
          </option>
        </select>
      </div>
    </div>

    <!-- Sản phẩm -->
    <div class="mb-3 row">
      <label class="col-sm-2 col-form-label">Sản phẩm</label>
      <div class="col-sm-4">
        <select class="form-select" th:field="*{product.id}" id="product">
          <option value="">Chọn sản phẩm</option>
          <option th:each="prod : ${products}"
                  th:value="${prod.id}"
                  th:text="${prod.name}"
                  th:data-type="${prod.productType.id}">
          </option>
        </select>
      </div>
    </div>

    <!-- Ngày mua -->
    <div class="mb-3 row">
      <label class="col-sm-2 col-form-label">Ngày mua</label>
      <div class="col-sm-4">
        <input type="text" class="form-control" id="orderDate" name="orderDateStr"
               th:value="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}">
      </div>
    </div>

    <!-- Số lượng -->
    <div class="mb-3 row">
      <label class="col-sm-2 col-form-label">Số lượng</label>
      <div class="col-sm-4">
        <input type="number" class="form-control" th:field="*{quantity}" min="1">
      </div>
    </div>

    <div class="mb-3 row">
      <div class="col-sm-2"></div>
      <div class="col-sm-4">
        <button type="submit" class="btn btn-primary">Lưu</button>
        <a th:href="@{/orders/list}" class="btn btn-secondary">Hủy</a>
      </div>
    </div>
  </form>
</div>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.js"></script>

<script>
  $(function() {
    // Khởi tạo datetime picker với jQuery UI
    $('#orderDate').datetimepicker({
      dateFormat: 'dd/mm/yy',
      timeFormat: 'HH:mm',
      controlType: 'select',
      oneLine: true,
      changeMonth: true,
      changeYear: true
    });
  });

    // Xử lý lọc sản phẩm theo loại
    $('#productType').change(function() {
      var selectedType = $(this).val();
      var productSelect = $('#product');

      // Ẩn tất cả sản phẩm
      productSelect.find('option[value!=""]').hide();

      if (selectedType) {
        // Hiện sản phẩm thuộc loại được chọn
        productSelect.find('option[data-type="' + selectedType + '"]').show();
      }

      // Reset selection
      productSelect.val('');
    });

    // Trigger change event để lọc sản phẩm ban đầu
    $('#productType').trigger('change');
  });
</script>
</body>
</html>